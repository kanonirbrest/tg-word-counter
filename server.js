const express = require('express');
const { Telegraf, session } = require('telegraf');
const LocalSession = require('telegraf-session-local');
const fs = require('fs');
const path = require('path');
const axios = require('axios');
const ffmpeg = require('fluent-ffmpeg');
require('dotenv').config();

const app = express();
const bot = new Telegraf(process.env.BOT_TOKEN);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–π
bot.use(session());
bot.use(new LocalSession({ database: 'sessions.json' }).middleware());

// –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
const tempDir = path.join(__dirname, 'temp');
if (!fs.existsSync(tempDir)) {
  fs.mkdirSync(tempDir);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞
async function downloadFile(fileId, fileName) {
  try {
    const file = await bot.telegram.getFile(fileId);
    const filePath = file.file_path;
    const url = `https://api.telegram.org/file/bot${process.env.BOT_TOKEN}/${filePath}`;
    
    const response = await axios({
      method: 'GET',
      url: url,
      responseType: 'stream'
    });
    
    const writer = fs.createWriteStream(fileName);
    response.data.pipe(writer);
    
    return new Promise((resolve, reject) => {
      writer.on('finish', resolve);
      writer.on('error', reject);
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞:', error);
    throw error;
  }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∞—É–¥–∏–æ—Ñ–∏–ª—å—Ç—Ä–∞
async function applyAudioFilter(inputFile, outputFile, filterType) {
  return new Promise((resolve, reject) => {
    let command = ffmpeg(inputFile);
    
    // –í—ã–±–∏—Ä–∞–µ–º —Ñ–∏–ª—å—Ç—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
    switch (filterType) {
      case 'bass':
        command = command.audioFilters([
          'bass=g=20:f=110:w=0.3',
          'volume=1.5'
        ]);
        break;
      case 'treble':
        command = command.audioFilters([
          'treble=g=20:f=3000:w=0.3',
          'volume=1.5'
        ]);
        break;
      case 'echo':
        command = command.audioFilters([
          'aecho=0.8:0.99:10:0.8',
          'volume=1.5'
        ]);
        break;
      case 'reverb':
        command = command.audioFilters([
          'areverse',
          'aecho=0.8:0.99:10:0.8',
          'areverse',
          'volume=1.5'
        ]);
        break;
      case 'speed':
        command = command.audioFilters([
          'atempo=2.0',
          'volume=1.5'
        ]);
        break;
      default:
        command = command.audioFilters([
          'volume=3.0'
        ]);
    }
    
    command
      .output(outputFile)
      .audioCodec('libopus')
      .audioBitrate('128k')
      .on('end', () => {
        resolve();
      })
      .on('error', (err) => {
        reject(err);
      })
      .run();
  });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ inline –∑–∞–ø—Ä–æ—Å–æ–≤
bot.on('inline_query', async (ctx) => {
  const query = ctx.inlineQuery.query;
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
  await ctx.answerInlineQuery([
    {
      type: 'article',
      id: '1',
      title: '–£—Å–∏–ª–∏—Ç—å –±–∞—Å',
      description: '–ù–∞–ª–æ–∂–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —É—Å–∏–ª–µ–Ω–∏—è –±–∞—Å–∞ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
      input_message_content: {
        message_text: 'üéµ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –±–∞—Å–∞',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ', switch_inline_query_current_chat: 'bass' }
          ]]
        }
      }
    },
    {
      type: 'article',
      id: '2',
      title: '–£—Å–∏–ª–∏—Ç—å –≤—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã',
      description: '–ù–∞–ª–æ–∂–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —É—Å–∏–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–∏—Ö —á–∞—Å—Ç–æ—Ç –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
      input_message_content: {
        message_text: 'üéµ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–∏—Ö —á–∞—Å—Ç–æ—Ç',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ', switch_inline_query_current_chat: 'treble' }
          ]]
        }
      }
    },
    {
      type: 'article',
      id: '3',
      title: '–î–æ–±–∞–≤–∏—Ç—å —ç—Ö–æ',
      description: '–ù–∞–ª–æ–∂–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —ç—Ö–æ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
      input_message_content: {
        message_text: 'üéµ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç—Ö–æ',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ', switch_inline_query_current_chat: 'echo' }
          ]]
        }
      }
    },
    {
      type: 'article',
      id: '4',
      title: '–î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—é',
      description: '–ù–∞–ª–æ–∂–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏–∏ –Ω–∞ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',
      input_message_content: {
        message_text: 'üéµ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏–∏',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ', switch_inline_query_current_chat: 'reverb' }
          ]]
        }
      }
    },
    {
      type: 'article',
      id: '5',
      title: '–£—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ',
      description: '–£—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è',
      input_message_content: {
        message_text: 'üéµ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ', switch_inline_query_current_chat: 'speed' }
          ]]
        }
      }
    },
    {
      type: 'article',
      id: '6',
      title: '–£—Å–∏–ª–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å',
      description: '–£—Å–∏–ª–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è',
      input_message_content: {
        message_text: 'üéµ –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏',
        reply_markup: {
          inline_keyboard: [[
            { text: 'üé§ –ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–µ', switch_inline_query_current_chat: 'volume' }
          ]]
        }
      }
    }
  ]);
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
bot.command('bass', async (ctx) => {
  await ctx.reply('üéµ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –±–∞—Å–∞');
  ctx.session = { filterType: 'bass' };
});

bot.command('treble', async (ctx) => {
  await ctx.reply('üéµ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –≤—ã—Å–æ–∫–∏—Ö —á–∞—Å—Ç–æ—Ç');
  ctx.session = { filterType: 'treble' };
});

bot.command('echo', async (ctx) => {
  await ctx.reply('üéµ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç—Ö–æ');
  ctx.session = { filterType: 'echo' };
});

bot.command('reverb', async (ctx) => {
  await ctx.reply('üéµ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏–∏');
  ctx.session = { filterType: 'reverb' };
});

bot.command('speed', async (ctx) => {
  await ctx.reply('üéµ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è');
  ctx.session = { filterType: 'speed' };
});

bot.command('volume', async (ctx) => {
  await ctx.reply('üéµ –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏');
  ctx.session = { filterType: 'volume' };
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
bot.on('voice', async (ctx) => {
  try {
    const voice = ctx.message.voice;
    const fileId = voice.file_id;
    const fileName = `${Date.now()}_${fileId}.ogg`;
    const inputPath = path.join(tempDir, fileName);
    const outputPath = path.join(tempDir, `processed_${fileName}`);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    const processingMsg = await ctx.reply('üéµ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...');
    
    // –°–∫–∞—á–∏–≤–∞–µ–º –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await downloadFile(fileId, inputPath);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ñ–∏–ª—å—Ç—Ä–∞ –∏–∑ —Å–µ—Å—Å–∏–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    let filterType = 'volume'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å–∏–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
    
    if (ctx.session && ctx.session.filterType) {
      filterType = ctx.session.filterType;
    } else {
      const text = ctx.message.text || '';
      if (text.includes('bass')) {
        filterType = 'bass';
      } else if (text.includes('treble')) {
        filterType = 'treble';
      } else if (text.includes('echo')) {
        filterType = 'echo';
      } else if (text.includes('reverb')) {
        filterType = 'reverb';
      } else if (text.includes('speed')) {
        filterType = 'speed';
      }
    }
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
    await applyAudioFilter(inputPath, outputPath, filterType);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∞—É–¥–∏–æ
    await ctx.replyWithVoice({ source: outputPath });
    
    // –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    fs.unlinkSync(inputPath);
    fs.unlinkSync(outputPath);
    
    // –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –æ–±—Ä–∞–±–æ—Ç–∫–µ
    await ctx.telegram.deleteMessage(ctx.chat.id, processingMsg.message_id);
    
    // –û—á–∏—â–∞–µ–º —Å–µ—Å—Å–∏—é
    ctx.session = null;
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
    await ctx.reply('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.command('start', async (ctx) => {
  await ctx.reply(
    '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—è:\n\n' +
    '1. –í –ª—é–±–æ–º —á–∞—Ç–µ –Ω–∞–ø–∏—à–∏—Ç–µ @–∏–º—è_–±–æ—Ç–∞\n' +
    '2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ñ–∏–ª—å—Ç—Ä–∞\n' +
    '3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n\n' +
    '–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n' +
    '/bass - —É—Å–∏–ª–∏—Ç—å –±–∞—Å\n' +
    '/treble - —É—Å–∏–ª–∏—Ç—å –≤—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã\n' +
    '/echo - –¥–æ–±–∞–≤–∏—Ç—å —ç—Ö–æ\n' +
    '/reverb - –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—é\n' +
    '/speed - —É—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ\n' +
    '/volume - —É—Å–∏–ª–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å'
  );
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /help
bot.command('help', async (ctx) => {
  await ctx.reply(
    '–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞:\n\n' +
    '1. –í –ª—é–±–æ–º —á–∞—Ç–µ –Ω–∞–ø–∏—à–∏—Ç–µ @–∏–º—è_–±–æ—Ç–∞\n' +
    '2. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø —Ñ–∏–ª—å—Ç—Ä–∞:\n' +
    '   - –£—Å–∏–ª–∏—Ç—å –±–∞—Å\n' +
    '   - –£—Å–∏–ª–∏—Ç—å –≤—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã\n' +
    '   - –î–æ–±–∞–≤–∏—Ç—å —ç—Ö–æ\n' +
    '   - –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—é\n' +
    '   - –£—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ\n' +
    '   - –£—Å–∏–ª–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å\n' +
    '3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n\n' +
    '–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n' +
    '/bass - —É—Å–∏–ª–∏—Ç—å –±–∞—Å\n' +
    '/treble - —É—Å–∏–ª–∏—Ç—å –≤—ã—Å–æ–∫–∏–µ —á–∞—Å—Ç–æ—Ç—ã\n' +
    '/echo - –¥–æ–±–∞–≤–∏—Ç—å —ç—Ö–æ\n' +
    '/reverb - –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–≤–µ—Ä–±–µ—Ä–∞—Ü–∏—é\n' +
    '/speed - —É—Å–∫–æ—Ä–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ\n' +
    '/volume - —É—Å–∏–ª–∏—Ç—å –≥—Ä–æ–º–∫–æ—Å—Ç—å'
  );
});

// –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.launch();

// –í–∫–ª—é—á–∞–µ–º graceful stop
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM')); 